{"title":"(Part 2) Blogging with Markdown","date":"28 June, 2020 9:50","description":"In this post, I delve into the details of how I built the blogging with markdown system","cover_image":"media/writing-pen-paper.jpg","published":true,"series":"How I created my personal site","body":"<p><img src=\"\" alt=\"\" class=\"feature-image\" style=\"display: none;\"></p><div class=\"picture-container\">\n  <figure style=\"width: 100%;padding-top: 66.640625%;background-color: rgb(91, 62, 47)\">\n    <picture>\n      <source type=\"image/webp\" media=\"(min-width: 501px)\" data-srcset=\"media/writing-pen-paper/large.webp\">\n      <source type=\"image/webp\" media=\"(max-width: 500px)\" data-srcset=\"media/writing-pen-paper/small.webp\">\n      <source type=\"image/jpg\" media=\"(min-width: 501px)\" data-srcset=\"media/writing-pen-paper/large.jpg\">\n      <source type=\"image/jpg\" media=\"(max-width: 500px)\" data-srcset=\"media/writing-pen-paper/small.jpg\">\n      <img alt=\"Placeholder\" data-src=\"media/writing-pen-paper/large.jpg\" class=\"lazyload blog-img\">\n    </picture>\n  </figure>\n  </div><p></p>\n<p class=\"series-links\"></p><blockquote>\n      <p>How I created my personal site series:</p>\n      <p>\n        <a rel=\"noopener\" target=\"_blank\" href=\"/blog/how-i-created-personal-site-part-1\">Part 1 - Tech Stack &amp; Design</a><br><a> Part 2 - Blogging with Markdown (You're reading it <img class=\"emoji\" draggable=\"false\" alt=\"😁\" src=\"https://twemoji.maxcdn.com/v/13.0.1/svg/1f601.svg\">)</a><br><a rel=\"noopener\" target=\"_blank\" href=\"/blog/how-i-created-personal-site-part-3\">Part 3 - Image Optimization Automation with Incremental builds</a><br>\n      </p>\n    </blockquote><p></p>\n<p>Hi! In this 2<sup>nd</sup> part of the series, I will expose the secret ingredient of what makes this blog work.</p>\n<h1 id=\"Problem\"><a class=\"heading-link\" href=\"blog/how-i-created-personal-site-part-2#Problem\">#</a>Problem</h1>\n<p>The problem was figuring out how to write the blog. Do I create a Rich-text Editor for myself first, and then copy-paste the generated HTML into every html page manually? No! Definitely No!</p>\n<p>This left me with only one other way. <mark>Markdown</mark>.</p>\n<p>This seemed the perfect way. Write stuff in markdown, process it and convert it into html and just fetch that html when called for in the blog page.</p>\n<p>But how do I store the metadata like title, date published, description or the cover image for social media?</p>\n<p>After some researching, I reached the complete answer.</p>\n<h1 id=\"Solution\"><a class=\"heading-link\" href=\"blog/how-i-created-personal-site-part-2#Solution\">#</a>Solution</h1>\n<p>Final solution was: Write content in markdown files, and store the metadata in those files only. Then extract all the relevant part, render to html the main content, and store the final data in a JSON files.</p>\n<p>Whoa Whoa. Wait up! That was quite fast. Lemme break it down.</p>\n<p>A typical markdown file would look like this:</p>\n<pre><code class=\"language-markdown\"><span class=\"hljs-comment\">## Hello</span>\n\n<span class=\"hljs-comment\"># Heading one</span>\n\n<span class=\"hljs-attribute\">I</span> have <span class=\"hljs-literal\">no</span> idea what **_I am doing here_**.\nWhat are any of us doing here anyway <img class=\"emoji\" draggable=\"false\" alt=\"🤔\" src=\"https://twemoji.maxcdn.com/v/13.0.1/svg/1f914.svg\">?\n</code></pre>\n<p>Now we'll adding metadata as <strong>Frontmatter</strong>. Frontmatter is a metadata storing approach Jekyll came up with. Here you store all your metadata on the top of the file. Like this:</p>\n<pre><code class=\"language-markdown\"><span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">title:</span> <span class=\"hljs-string\">\"The title\"</span>\n<span class=\"hljs-attr\">description:</span> <span class=\"hljs-string\">\"the description\"</span>\n<span class=\"hljs-meta\">---\n</span></code></pre>\n<p>So our markdown file becomes:</p>\n<pre><code class=\"language-markdown\"><span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">title:</span> <span class=\"hljs-string\">\"The title\"</span>\n<span class=\"hljs-attr\">description:</span> <span class=\"hljs-string\">\"the description\"</span>\n<span class=\"hljs-meta\">---\n</span>\n<span class=\"hljs-comment\">## Hello</span>\n\n<span class=\"hljs-comment\"># Heading one</span>\n\n<span class=\"hljs-string\">I</span> <span class=\"hljs-string\">have</span> <span class=\"hljs-literal\">no</span> <span class=\"hljs-string\">idea</span> <span class=\"hljs-string\">what</span> <span class=\"hljs-string\">**_I</span> <span class=\"hljs-string\">am</span> <span class=\"hljs-string\">doing</span> <span class=\"hljs-string\">here_**.</span>\n<span class=\"hljs-string\">What</span> <span class=\"hljs-string\">are</span> <span class=\"hljs-string\">any</span> <span class=\"hljs-string\">of</span> <span class=\"hljs-string\">us</span> <span class=\"hljs-string\">doing</span> <span class=\"hljs-string\">here</span> <span class=\"hljs-string\">anyway</span> <span class=\"hljs-string\"><img class=\"emoji\" draggable=\"false\" alt=\"🤔\" src=\"https://twemoji.maxcdn.com/v/13.0.1/svg/1f914.svg\">?</span>\n</code></pre>\n<p>Looks nice. But how do we process this data(aka convert it to html and store the metadata away)</p>\n<h1 id=\"Processing-the-data\"><a class=\"heading-link\" href=\"blog/how-i-created-personal-site-part-2#Processing-the-data\">#</a>Processing the data</h1>\n<p>So let's assume we have written a full fledged blog post with all the metadata on top. How do we get it from <code>markdown</code> to a visual blog page viewable in a browser?</p>\n<p>For that we're going to use 2 NPM Packages.</p>\n<ul>\n<li>\n<p><a href=\"https://www.npmjs.com/package/front-matter\" target=\"_blank\" rel=\"noopener\">front-matter</a> for gathering the metadata.</p>\n</li>\n<li>\n<p><a href=\"https://www.npmjs.com/package/markdown-it\" target=\"_blank\" rel=\"noopener\">markdown-it</a> for rendering markdown content into html.</p>\n</li>\n</ul>\n<h2 id=\"front-matter\"><a class=\"heading-link\" href=\"blog/how-i-created-personal-site-part-2#front-matter\">#</a>front-matter</h2>\n<p><code>front-matter</code> takes in markdown content, tears it apart, and return an object:</p>\n<pre><code class=\"language-javascript\">{\n  attributes: {\n    ...\n  },\n  body: {\n    <span class=\"hljs-string\">\"...\"</span>\n  }\n}\n</code></pre>\n<p><code>attributes</code> is a key-value pair of all metadata keys to their values.</p>\n<p><code>body</code> is the main content you wrote in your markdown, just below the metadata. Note that <code>body</code> isn't rendered to html yet. We still need to do that</p>\n<p>For example:</p>\n<p>Markdown code:</p>\n<pre><code class=\"language-markdown\"><span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">title:</span> <span class=\"hljs-string\">Krrish</span>\n<span class=\"hljs-attr\">description:</span> <span class=\"hljs-string\">Krishna</span> <span class=\"hljs-string\">Mehra</span> <span class=\"hljs-string\">leaves</span> <span class=\"hljs-string\">on</span> <span class=\"hljs-string\">a</span> <span class=\"hljs-string\">journey</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">find</span> <span class=\"hljs-string\">his</span> <span class=\"hljs-string\">father.</span>\n<span class=\"hljs-attr\">year_released:</span> <span class=\"hljs-number\">2006</span>\n<span class=\"hljs-meta\">---\n</span>\n<span class=\"hljs-string\">Krrish</span> <span class=\"hljs-string\">is</span> <span class=\"hljs-string\">a</span> <span class=\"hljs-string\">very</span> <span class=\"hljs-string\">captivating</span> <span class=\"hljs-string\">**superhero**.</span>\n</code></pre>\n<p>will become</p>\n<pre><code class=\"language-javascript\">{\n  attributes: {\n    title: <span class=\"hljs-string\">'Krrish'</span>,\n    description: <span class=\"hljs-string\">'Krishna Mehra leaves on a journey to find his father.'</span>,\n    year_released: <span class=\"hljs-number\">2006</span>\n  },\n  <span class=\"hljs-selector-tag\">body</span>: <span class=\"hljs-string\">'Krrish is a very captivating **superhero**.'</span>\n}\n</code></pre>\n<p>Notice how all the metadata got beautifully condensed into an object, which we can use in any way.</p>\n<p>And the <code>body</code> is the part below the front matter, just completely unchanged.</p>\n<h2 id=\"markdown-it\"><a class=\"heading-link\" href=\"blog/how-i-created-personal-site-part-2#markdown-it\">#</a>markdown-it</h2>\n<p>Now we can use markdown-it to render the <code>markdown</code> in <code>body</code> to html.</p>\n<p>The basic code is this simple:</p>\n<pre><code class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> md = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"markdown-it\"</span>)();\n\n<span class=\"hljs-keyword\">const</span> result = md.render(<span class=\"hljs-string\">\"# This is a heading\"</span>);\n</code></pre>\n<p>Now we have the rendered html and metadata, we caan simply store these in a JSON file, like this:</p>\n<pre><code class=\"language-json\">{\n  <span class=\"hljs-attr\">\"title\"</span>: <span class=\"hljs-string\">\"Krrish\"</span>,\n  <span class=\"hljs-attr\">\"description\"</span>: <span class=\"hljs-string\">\"Krishna Mehra leaves on a journey to find his father.\"</span>,\n  <span class=\"hljs-attr\">\"year_released\"</span>: <span class=\"hljs-number\">2006</span>,\n  <span class=\"hljs-attr\">\"body\"</span>: <span class=\"hljs-string\">\"&lt;p&gt;Krrish is a very captivating &lt;b&gt;superhero&lt;/b&gt;.&lt;/p&gt;\"</span>\n}\n</code></pre>\n<p>Then in our main Stencil component, we can simply fetch this JSON file, and show its content. Easy Peasy.</p>\n<p>BUT WAIT!!!</p>\n<h1 id=\"It-gets-messy\"><a class=\"heading-link\" href=\"blog/how-i-created-personal-site-part-2#It-gets-messy\">#</a>It gets messy</h1>\n<p>Everything is going very smoothly. But we have forgotten one very important thing: <mark>Code Syntax Highlighting!</mark></p>\n<p>There's no developer blog without some cool code syntax highlighting to show off their coding skills. So we need a way to have code syntax highlighting in our blog.</p>\n<p>These will come in mind for most people:</p>\n<ul>\n<li><a href=\"https://www.npmjs.com/package/prismjs\" target=\"_blank\" rel=\"noopener\">prismjs</a></li>\n<li><a href=\"https://www.npmjs.com/package/highlight.js\" target=\"_blank\" rel=\"noopener\">highlight.js</a></li>\n</ul>\n<p>These are good libraries. No doubt. They both integrate with <code>markdown-it</code> to generate highlighted code at build time only. They just lack one thing: VS Code level consistency.</p>\n<p>They both can't highlight code the way VS Code does. If you use VS Code, you know what I'm talking about. Nothing beats VS Code at syntax highlighting. What if there was a way to use VS Code for syntax highlighting ...</p>\n<p>Aha! There is a way. Lemme introduce you to the amazing and very underrated, <a href=\"https://github.com/octref/shiki\" target=\"_blank\" rel=\"noopener\">ShikiJS</a>.</p>\n<p>Take my word, this is the best syntax highlighter there could be. It's syntax highlighting works the same way VS Code's themes work: JSON Config files. Shiki has some beautiful pre-built themes, but if you want your favorite theme, it can do that too. Just pass it the config JSON file of that theme, and you're all set.</p>\n<p>The basic code for integrating <code>shiki</code> with <code>markdown-it</code> is this:</p>\n<pre><code class=\"language-javascript\">const fs = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"fs\"</span>);\nconst markdown = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"markdown-it\"</span>);\nconst shiki = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"shiki\"</span>);\n\nshiki\n  .getHighlighter({\n    theme: <span class=\"hljs-string\">\"nord\"</span>,\n  })\n  .<span class=\"hljs-keyword\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">(highlighter)</span> =&gt;</span> {\n    const md = markdown({\n      html: <span class=\"hljs-literal\">true</span>,\n      highlight: <span class=\"hljs-function\"><span class=\"hljs-params\">(code, lang)</span> =&gt;</span> {\n        <span class=\"hljs-keyword\">return</span> highlighter.codeToHtml(code, lang);\n      },\n    });\n\n    const html = md.render(fs.readFileSync(<span class=\"hljs-string\">\"index.md\"</span>, <span class=\"hljs-string\">\"utf-8\"</span>));\n    const out = `<span class=\"javascript\">\n    &lt;title&gt;Shiki&lt;/title&gt;\n    <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span> <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">\"stylesheet\"</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"style.css\"</span>&gt;</span>\n    ${html}\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"index.js\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n  </span></span>`;\n    fs.writeFileSync(<span class=\"hljs-string\">\"index.html\"</span>, out);\n\n    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"done\"</span>);\n  });\n</code></pre>\n<p>I copied the above code from the <a href=\"https://shiki.matsu.io/\" target=\"_blank\" rel=\"noopener\">main website</a>, but you can always check it out at my <a href=\"https://github.com/puruvj/puruvjdev\" target=\"_blank\" rel=\"noopener\">Github repo</a>.</p>\n<h1 id=\"Structure\"><a class=\"heading-link\" href=\"blog/how-i-created-personal-site-part-2#Structure\">#</a>Structure</h1>\n<p>All the mechanics aside, we haven't talked about how I actually structure my blog posts. Here's a simple skeleton structure of the metadata:</p>\n<ul>\n<li><strong>title</strong>: The title of the blog post (Duh! <img class=\"emoji\" draggable=\"false\" alt=\"🙄\" src=\"https://twemoji.maxcdn.com/v/13.0.1/svg/1f644.svg\">)</li>\n<li><strong>description</strong>: The description of the blog post. This shows up on the blogs overview page as a simple description and in <code>&lt;meta name=\"description\"&gt;</code> too, for social media sharing</li>\n<li><strong>date</strong>: The date when the post was written. I put it in manually when I start writing.</li>\n<li><strong>cover_image</strong>: This isn't the cover image that you looked at, at the top of this very blog post. That's a manual image. It is used for social media cards.</li>\n<li><strong>published</strong>: If I do some horrible, horrible mistake in my feed and have already published it(aka pushed it to Vercel), I can just set this property as <code>false</code>, and it will be removed until I set it to <code>true</code> (Or remove it. Works as <code>true</code> only)</li>\n</ul>\n<p>There is some more dark magic I apply to this blog, but I will get to that in the next post.</p>\n<p class=\"series-links\"></p><blockquote>\n      <p>How I created my personal site series:</p>\n      <p>\n        <a rel=\"noopener\" target=\"_blank\" href=\"/blog/how-i-created-personal-site-part-1\">Part 1 - Tech Stack &amp; Design</a><br><a> Part 2 - Blogging with Markdown (You're reading it <img class=\"emoji\" draggable=\"false\" alt=\"😁\" src=\"https://twemoji.maxcdn.com/v/13.0.1/svg/1f601.svg\">)</a><br><a rel=\"noopener\" target=\"_blank\" href=\"/blog/how-i-created-personal-site-part-3\">Part 3 - Image Optimization Automation with Incremental builds</a><br>\n      </p>\n    </blockquote><p></p>\n","id":"how-i-created-personal-site-part-2","reading_time":3.47}