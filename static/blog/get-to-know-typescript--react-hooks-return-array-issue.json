{"title":"React TypeScript Hooks quirk when returning array","description":"React and TypeScript make up a great pair. But when you're trying to make your own hooks, and returning an array, TypeScript yells at your. Find out why.","date":"19 Feb, 2021","cover_image":"media/blog-social-intro.png","body":"<p><img src=\"\" alt=\"\" class=\"feature-image\" style=\"display: none;\"></p><div class=\"picture-container\">\n  <div class=\"gif-vid-container\">\n    <video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n      <source src=\"/media/segregate-array-return-types-react-batman-robin/vidgif.mp4\" type=\"video/mp4\">\n      Your browser doesn't support HTML5 video playback. <a href=\"/media/segregate-array-return-types-react-batman-robin.gif\" target=\"_blank\" rel=\"noopener\">See the gif here</a>\n    </video>\n  </div>\n  </div><p></p>\n<p>React and TypeScript make for a mean pair. Combined, they can rule the whole world together. But sometimes, these two can get off on a tangent about some small details, and we the devs have to be the scapegoat in their battle of egos. One such problem is when we're making our own custom hooks, which return an array of a value and a function, just like <code>useState</code>.</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #A6ACCD\">state</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> setState</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">useState</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">null</span><span style=\"color: #A6ACCD\">)</span><span style=\"color: #89DDFF\">;</span></span></code></pre>\n<p>It's clearly visible that <code>state</code> is a value, and <code>setState</code> is a function. When you use this hook, everything works out fine, and these 2 have their own types on them.</p>\n<p>But the issue happens when you're trying to make your own hook that returns an array, very similar in structure to <code>useState</code>. Let's see an example:</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">useState</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">useEffect</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #C792EA\">type</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">TTheme</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">light</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">dark</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">export</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">function</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">useTheme</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// Media query</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">systemTheme</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">TTheme</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">matchMedia</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">(prefers-color-scheme: dark)</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">matches</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">?</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">dark</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">light</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">localValue</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">localStorage</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getItem</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">theme:type</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #F07178\">) </span><span style=\"color: #89DDFF\">as</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">TTheme</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #A6ACCD\">theme</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">setTheme</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useState</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">light</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #82AAFF\">useEffect</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">setTheme</span><span style=\"color: #F07178\">(</span><span style=\"color: #A6ACCD\">localValue</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">||</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">systemTheme</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">},</span><span style=\"color: #F07178\"> [])</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #82AAFF\">useEffect</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #A6ACCD\">document</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">body</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">dataset</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">theme</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">theme</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #A6ACCD\">localStorage</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">setItem</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">theme</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">theme</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">},</span><span style=\"color: #F07178\"> [</span><span style=\"color: #A6ACCD\">theme</span><span style=\"color: #F07178\">])</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #F07178\"> [</span><span style=\"color: #A6ACCD\">theme</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">setTheme</span><span style=\"color: #F07178\">]</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre>\n<p>This hook here does very simple thing. Looks for stored theme in localStorage. If it's not there, it fall backs to device preference. When it has decided what theme to use, it sets local state variable <code>theme</code> to that value for future use in the first <code>useEffect</code> hook. The first <code>useEffect</code> has an empty array as the dependency list, so it basically acts like a <code>componentDidMount</code> in this case.</p>\n<p>Our 2nd <code>useEffect</code> basically watches the <code>theme</code> variable, and reacts by appending <code>data-theme=\"{theme}\"</code> on <code>&lt;body&gt;</code>, so that CSS can use that to change the actual theme. Lastly it stores the current preference in localStorage, so it can be picked off when user visits the site again.</p>\n<p>Lastly we're returning an array of <code>[theme, setTheme]</code>, so we can utilise the theme and change it from anywhere. All fine.</p>\n<p><strong>Until you try to use this hook <img class=\"emoji\" draggable=\"false\" alt=\"😈\" src=\"https://twemoji.maxcdn.com/v/13.0.1/svg/1f608.svg\"></strong></p>\n<p>Let's say you're writing a component whose job is to switch the theme, and it uses our <code>useTheme</code> hook to do it.</p>\n<p>You create a function to change the theme using <code>setTheme</code> exported from this hook:</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #A6ACCD\">theme</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> setTheme</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">useTheme</span><span style=\"color: #A6ACCD\">()</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> toggleTheme </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">setTheme</span><span style=\"color: #A6ACCD\">(theme </span><span style=\"color: #89DDFF\">===</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">light</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">?</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">dark</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">light</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #A6ACCD\">)</span><span style=\"color: #89DDFF\">;</span></span></code></pre>\n<p>And you run into a weird error:</p>\n<p><img src=\"\" alt=\"\" class=\"feature-image\" style=\"display: none;\"></p><div class=\"picture-container\">\n  <div class=\"gif-vid-container\">\n    <video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n      <source src=\"/media/segregate-array-return-types-react-error-array-type/vidgif.mp4\" type=\"video/mp4\">\n      Your browser doesn't support HTML5 video playback. <a href=\"/media/segregate-array-return-types-react-error-array-type.gif\" target=\"_blank\" rel=\"noopener\">See the gif here</a>\n    </video>\n  </div>\n  </div><p></p>\n<p>That's weird. Why is that happening?</p>\n<p>If you see closely, the type of <code>setTheme</code> here is showed as</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #A6ACCD\">string </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #A6ACCD\"> React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">Dispatch</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #A6ACCD\">React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">SetStateAction</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #A6ACCD\">string</span><span style=\"color: #89DDFF\">&gt;&gt;</span></span></code></pre>\n<p>But that's weird. We clearly know that <code>setTheme</code> is a function. If you hover over it in your editor, you can confirm it's type is <code>React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;</code>, it doesn't have any <code>string</code> type as a constituent.</p>\n<p>But wait, that's not it. If you hover over <code>theme</code>, it's type is the same as <code>setState</code> above.</p>\n<p>And when you hover over <code>useTheme</code>, you find that it returns an Array of the type above <img class=\"emoji\" draggable=\"false\" alt=\"👇\" src=\"https://twemoji.maxcdn.com/v/13.0.1/svg/1f447.svg\"></p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #A6ACCD\">(string </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #A6ACCD\"> React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">Dispatch</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #A6ACCD\">React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">SetStateAction</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #A6ACCD\">string</span><span style=\"color: #89DDFF\">&gt;&gt;</span><span style=\"color: #A6ACCD\">)[]</span></span></code></pre>\n<p><img src=\"\" alt=\"\" class=\"feature-image\" style=\"display: none;\"></p><div class=\"picture-container\">\n  <div class=\"gif-vid-container\">\n    <video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n      <source src=\"/media/segregate-array-return-types-react-confusion/vidgif.mp4\" type=\"video/mp4\">\n      Your browser doesn't support HTML5 video playback. <a href=\"/media/segregate-array-return-types-react-confusion.gif\" target=\"_blank\" rel=\"noopener\">See the gif here</a>\n    </video>\n  </div>\n  </div><p></p>\n<p>This is weird. This Array type assumes</p>\n","id":"get-to-know-typescript--react-hooks-return-array-issue","reading_time":2.9725}